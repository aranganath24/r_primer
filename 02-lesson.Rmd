# Loading data

```{r, echo=-1}
setwd("/Users/adra7980/Documents/git_repositories/r_primer/workshop_data")
# Read in persson and tabellini dataset
persson_tabellini_original<-read_csv("persson_tabellini_workshop.csv")
```

```{r}
# Make a copy of the dataset so we don't alter the original dataset; then, view
# the copied dataset 
pt_copy<-persson_tabellini_original
```

```{r}
# Print contents of "pt_copy"
pt_copy
```

```{r}
View(pt_copy)
```

```{r, echo=FALSE}
kable(head(pt_copy))
```

# Summary statistics

## Generating a table of summary statistics

```{r}
# Generate summary statistics for "pt_copy" and assign to new object named "pt_copy_summarystats1"
pt_copy_summarystats1<-describe(pt_copy)
```

```{r}
# Print contents of "pt_copy_summarystats1"
pt_copy_summarystats1
```

```{r, echo=F}
kable(head(pt_copy_summarystats1))
```

## Exporting a summary statistics table as a CSV file

```{r}
# add rownames to pt_copy_summarystats1
pt_copy_summarystats1$variable<-rownames(pt_copy_summarystats1)

# make "variables" field the first one in the dataset
pt_copy_summarystats1<-pt_copy_summarystats1 %>% relocate(variable)
```

```{r}
# write out summary statistics table as CSV file
write_csv(pt_copy_summarystats1, "/Users/adra7980/Documents/git_repositories/r_primer/written_data/pt_copy_summarystats1.csv")
```

## Using ```stargazer``` to create and export summary statistics with

```{r}
# Make the summary stats into a data frame
pt_copy_df<-as.data.frame(pt_copy)
```

```{r, results=FALSE}
# Use stargazer to export summary statistics as a text file
stargazer(pt_copy_df, type="text", title="Descriptive Statistics", digits=1, out="summary_stats.txt")
```

```{r, results=FALSE}
# Use stargazer to export summary statistics as an html file
stargazer(pt_copy_df, type="text", title="Descriptive Statistics", digits=1, out="summary_stats.html")

```

## Summary statistics and grouping variables

### Subsetting summary statistics by group with the ```describe``` function

```{r}
# Option 1
summary_stats_by_continent<-describeBy(pt_copy, pt_copy$continent)
```

```{r}
# Accessing continent-level summary statistics for africa from the "summary_stats_by_continent" list
summary_stats_by_continent[["africa"]]
```

```{r}
# Accessing continent-level summary statistics for africa from the "summary_stats_by_continent" list; alternate syntax
summary_stats_by_continent %>% pluck("africa")
```

```{r}
# Group-level summary statistics can be assigned to their own object for easy retrieval
asia_europe_summary_statistics<-summary_stats_by_continent %>% pluck("asiae")
```

```{r}
# retrieve summary statistics for Asia/Europe 
asia_europe_summary_statistics
```

The "vars" column in the summary statistics table is an index variable; it can be removed with the following:

```{r}
# removes "vars" indexing variable from "asia_europe_summary_statistics"
asia_europe_summary_statistics<-asia_europe_summary_statistics %>% select(-vars)
```

```{r}
asia_europe_summary_statistics
```

### Generating group-level summary statistics with the ```summarize``` function from ```dplyr``` 

```{r}
# Generate a table that displays summary statistics for trade at the continent level and assign to object named "trade_age_by_continent"
trade_age_by_continent<-pt_copy %>% group_by(continent) %>% 
                                    summarise(meanTrade=mean(trade),sdTrade=sd(trade),
                                              meanAge=mean(age), sdAge=sd(age),
                                              n=n())
```

```{r}
# prints contents of "trade_age_by_continent"
trade_age_by_continent
```

## Generating crosstabs

### Crosstabs with ```tabyl```

```{r}
crosstab_federal_continent<-pt_copy %>% tabyl(federal, continent)

crosstab_federal_continent
```


```{r}
crosstab_majoritarian_continent<-pt_copy %>% tabyl(maj, continent)

crosstab_majoritarian_continent
```


```{r}
pt_copy %>% tabyl(maj, continent)
```

### Crosstabs with ```tbl_cross```

```{r}
tbl_cross(pt_copy, row=maj, col=continent)
```

```{r}
tbl_cross(pt_copy, row=federal, col=continent)
```

# Basic Data Cleaning and Preparation Tasks

## Rearranging columns

```{r}
pt_copy
```

```{r}
# bring the "country" column to the front of the dataset
pt_copy<-pt_copy %>% relocate(country)
pt_copy
```

```{r}
pt_copy<-pt_copy %>% relocate(country, list, trade, oecd)

pt_copy
```

## Renaming variables

```{r}
## Renaming a variable (renames "list" to "party_list")
pt_copy<-pt_copy %>% rename(party_list=list)

pt_copy
```


## Sorting a dataset in ascending or descending order with respect to a variable

```{r}
# sorting in ascending (low to high) order with respect to the "trade" variable
pt_copy<-pt_copy %>% arrange(trade)
pt_copy
```

```{r}
# sorting in descending (high to low) order with respect to the "trade" variable
pt_copy<-pt_copy %>% arrange(desc(trade))
pt_copy
```

## Creating new variables based on existing variables

ratio of revenue to expenditures

```{r}
# Create new variable named "rev_exp" that is calculated as a ratio of "cgrev" (central government revenues) to "cgexp" (central government expenditures), and relocates "country", "cgexp", "cgrev", "trade", and the newly created "rev_exp" to the front of the dataset
pt_copy<-pt_copy %>% mutate(rev_exp=(cgrev/cgexp)) %>% 
                     relocate(country, cgexp, cgrev, trade, rev_exp)
```

```{r}
pt_copy
```


## Selecting or deleting variables 

### Selecting variables

```{r}
# Selects "country", "cgexp", "cgrev", and "rev_exp" variables from the "pt_copy" dataset
pt_copy %>% select(country, cgexp, cgrev, trade, rev_exp)
```

```{r}
# Selects "country", "cgexp", "cgrev", and "rev_exp" variables from the "pt_copy" dataset and assigns the selection to a new object named "pt_copy_selection"

pt_copy_selection<-pt_copy %>% select(country, cgexp, cgrev, trade, rev_exp)
```

```{r}
pt_copy_selection
```

### Deleting variables 

```{r}
# Deletes "cgrev" variable from "pt_copy_selection" dataset
pt_copy_selection %>% select(-cgrev)
```

```{r}
# Deletes "cgrev" AND "cgexp" variables from "pt_copy_selection" dataset
pt_copy_selection %>% select(-c(cgexp, cgrev))
```

```{r}
# Deletes "cgrev" AND "cgexp" variables from "pt_copy_selection" dataset and assigns the result to a new object named "pt_copy_trade_revexp"
pt_copy_trade_revexp<-pt_copy_selection %>% select(-c(cgexp, cgrev))
```

```{r}
# Prints contents of "pt_copy_trade_revexp"
pt_copy_trade_revexp
```

```{r}
# Deletes "cgrev" AND "cgexp" variables from "pt_copy_selection" dataset and assigns the result to "pt_copy_selection", thereby overwriting the existing version of "pt_copy_selection" with a new version that reflects these deletions
pt_copy_selection<-pt_copy_selection %>% select(-c(cgexp, cgrev))
```

```{r}
# prints updated contents of "pt_copy_selection"
pt_copy_selection
```

## Recoding variables

### Creating Dummy Variables from Continuous Numeric Variables

```{r}
# Creates a new dummy variable based on the existing "trade" variable named "trade_open" (which takes on a value of "1" if "trade" is greater than or equal to 77, and 0 otherwise) and then moves the newly created variable to the front of the dataset along with "country" and "trade"; all changes are assigned to "pt_copy", thereby overwriting the existing version of "pt_copy"

pt_copy<-pt_copy %>% mutate(trade_open=ifelse(trade>=77, 1, 0)) %>% 
                     relocate(country, trade_open, trade)
```

```{r}
# prints updated contents of "pt_copy"; note the newly created dummy variable
pt_copy
```

### Creating categorical variables from continuous numeric variables

```{r}
# Creates a new variable in the "pt_copy" dataset named "trade_level" (that is coded as "Low Trade" when the "trade" variable is greater than 15 and less than 50, coded as "Intermediate Trade" when "trade" is greater than or equal to 50 and less than 100, and coded as "High TradE" when "trade" is greater than or equal to 100), and then reorders the dataset such that "country", "trade_level", and "trade" are the first three variables in the dataset
pt_copy<-pt_copy %>% mutate(trade_level=case_when(trade>15 & trade<50~"Low_Trade",
                                                  trade>=50 & trade<100~"Intermediate_Trade",
                                                  trade>=100~"High_Trade")) %>% 
                    relocate(country, trade_level, trade)
```

```{r}
# prints updated contents of "pt_copy"; note the newly created categorical variable
pt_copy
```

### Creating dummmy variables from categorical variables 

```{r, message=FALSE}
pt_copy<-pt_copy %>% dummy_cols("trade_level") %>% 
                      relocate(country, trade_level, trade_level_High_Trade, trade_level_Intermediate_Trade, trade_level_Low_Trade)
```

```{r}
pt_copy
```

## Subsetting data based on criteria

### The ```filter``` function

```{r}
oecd_countries<-pt_copy %>% filter(oecd==1) %>% 
                            relocate(country, oecd)
```

```{r}
oecd_countries
```

```{r}
high_revenues<-pt_copy %>% filter(rev_exp>1) %>% 
                              relocate(country, rev_exp)
                        
```

```{r}
high_revenues
```

```{r}
minority_catholic<-pt_copy %>% filter(catho80<=50) %>% 
                               relocate(country, catho80)
```

```{r}
minority_catholic
```

Using the ```&``` operator 

```{r}
oecd_federal_countries<-pt_copy %>% filter(oecd==1 & federal==1) %>% 
                                      relocate(country, oecd, federal)
```

```{r}
oecd_federal_countries
```

Using the ```|``` operator

```{r}
asia_europe_africa<-pt_copy %>% filter(continent=="africa"|continent=="asiae") %>% 
                                  relocate(continent)
```

```{r}
asia_europe_africa
```

Filtering for observations that do NOT meet a condition:

```{r}
pt_copy_sans_africa<-pt_copy %>% filter(continent!="africa") %>% relocate(continent)
```

```{r}
pt_copy_sans_africa
```

# Exploratory visualizations using ```ggplot```










correlation matrix
```{r}
x<-pt_copy_trade_revexp %>% select(-country)
cor(x, use="complete.obs")
```












